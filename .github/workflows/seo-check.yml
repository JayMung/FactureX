name: SEO Check

on:
  pull_request:
    paths:
      - 'index.html'
      - 'public/og-image.svg'
      - 'public/sitemap.xml'
      - 'public/robots.txt'

jobs:
  seo-validation:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Check Open Graph tags
        run: |
          echo "ğŸ” VÃ©rification des mÃ©tadonnÃ©es Open Graph..."
          
          # VÃ©rifier la prÃ©sence des tags OG essentiels
          if ! grep -q 'property="og:title"' index.html; then
            echo "âŒ Erreur: og:title manquant"
            exit 1
          fi
          
          if ! grep -q 'property="og:description"' index.html; then
            echo "âŒ Erreur: og:description manquant"
            exit 1
          fi
          
          if ! grep -q 'property="og:image"' index.html; then
            echo "âŒ Erreur: og:image manquant"
            exit 1
          fi
          
          if ! grep -q 'property="og:url"' index.html; then
            echo "âŒ Erreur: og:url manquant"
            exit 1
          fi
          
          echo "âœ… Tous les tags Open Graph essentiels sont prÃ©sents"
      
      - name: Check Twitter Cards
        run: |
          echo "ğŸ” VÃ©rification des Twitter Cards..."
          
          if ! grep -q 'property="twitter:card"' index.html; then
            echo "âŒ Erreur: twitter:card manquant"
            exit 1
          fi
          
          if ! grep -q 'property="twitter:title"' index.html; then
            echo "âŒ Erreur: twitter:title manquant"
            exit 1
          fi
          
          if ! grep -q 'property="twitter:image"' index.html; then
            echo "âŒ Erreur: twitter:image manquant"
            exit 1
          fi
          
          echo "âœ… Tous les tags Twitter Cards essentiels sont prÃ©sents"
      
      - name: Check meta description
        run: |
          echo "ğŸ” VÃ©rification de la meta description..."
          
          if ! grep -q 'name="description"' index.html; then
            echo "âŒ Erreur: meta description manquante"
            exit 1
          fi
          
          # VÃ©rifier que la description n'est pas trop courte (min 50 chars)
          desc_length=$(grep 'name="description"' index.html | sed 's/.*content="\([^"]*\)".*/\1/' | wc -c)
          if [ $desc_length -lt 50 ]; then
            echo "âš ï¸  Avertissement: La description est trop courte (min 50 caractÃ¨res recommandÃ©s)"
          fi
          
          # VÃ©rifier que la description n'est pas trop longue (max 160 chars)
          if [ $desc_length -gt 160 ]; then
            echo "âš ï¸  Avertissement: La description est trop longue (max 160 caractÃ¨res recommandÃ©s)"
          fi
          
          echo "âœ… Meta description prÃ©sente"
      
      - name: Check title tag
        run: |
          echo "ğŸ” VÃ©rification du title tag..."
          
          if ! grep -q '<title>' index.html; then
            echo "âŒ Erreur: title tag manquant"
            exit 1
          fi
          
          # VÃ©rifier la longueur du titre (max 60 chars recommandÃ©s)
          title_length=$(grep '<title>' index.html | sed 's/<title>\(.*\)<\/title>/\1/' | wc -c)
          if [ $title_length -gt 60 ]; then
            echo "âš ï¸  Avertissement: Le titre est trop long (max 60 caractÃ¨res recommandÃ©s pour Google)"
          fi
          
          echo "âœ… Title tag prÃ©sent"
      
      - name: Check canonical URL
        run: |
          echo "ğŸ” VÃ©rification de l'URL canonique..."
          
          if ! grep -q 'rel="canonical"' index.html; then
            echo "âŒ Erreur: URL canonique manquante"
            exit 1
          fi
          
          echo "âœ… URL canonique prÃ©sente"
      
      - name: Check OG image exists
        run: |
          echo "ğŸ” VÃ©rification de l'image Open Graph..."
          
          if [ ! -f "public/og-image.svg" ]; then
            echo "âŒ Erreur: Image OG manquante (public/og-image.svg)"
            exit 1
          fi
          
          echo "âœ… Image Open Graph prÃ©sente"
      
      - name: Check sitemap
        run: |
          echo "ğŸ” VÃ©rification du sitemap..."
          
          if [ ! -f "public/sitemap.xml" ]; then
            echo "âŒ Erreur: Sitemap manquant (public/sitemap.xml)"
            exit 1
          fi
          
          echo "âœ… Sitemap prÃ©sent"
      
      - name: Check robots.txt
        run: |
          echo "ğŸ” VÃ©rification du robots.txt..."
          
          if [ ! -f "public/robots.txt" ]; then
            echo "âŒ Erreur: robots.txt manquant"
            exit 1
          fi
          
          if ! grep -q 'Sitemap:' public/robots.txt; then
            echo "âš ï¸  Avertissement: Sitemap non rÃ©fÃ©rencÃ© dans robots.txt"
          fi
          
          echo "âœ… robots.txt prÃ©sent"
      
      - name: Summary
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Validation SEO terminÃ©e avec succÃ¨s!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ“‹ Checklist:"
          echo "  âœ… Open Graph tags"
          echo "  âœ… Twitter Cards"
          echo "  âœ… Meta description"
          echo "  âœ… Title tag"
          echo "  âœ… Canonical URL"
          echo "  âœ… OG Image"
          echo "  âœ… Sitemap"
          echo "  âœ… Robots.txt"
          echo ""
          echo "ğŸš€ PrÃªt pour le dÃ©ploiement!"
